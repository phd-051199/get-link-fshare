const isFile=/(https?:\/\/)?(www\.)?fshare\.vn\/file\/.+/,isFolder=/(https?:\/\/)?(www\.)?fshare\.vn\/folder\/.+/;$(document).ready(function(){$.fn.main.formValidation(),$.fn.main.registerEvent(),$.fn.main.autocomplete()}),$.fn.extend({element:{mainForm:"#mainForm",modalFilmSearch:"#filmSearchForm",modalggSearch:"#ggSearchForm"},main:{autocomplete:function(){$("#filmName").autoComplete({resolver:"ajax",resolverSettings:{url:"/api/ac",queryKey:"keyword",requestThrottling:300}})},formValidation:function(){$.validator.addMethod("isFsLink",function(e,t){return this.optional(t)||isFile.test(e)||isFolder.test(e)},"Invalid format."),$($.fn.element.mainForm).validate({onfocusout:function(e){$(e).valid()},rules:{original:{required:!0,isFsLink:!0}},errorClass:"error is-invalid"}),$($.fn.element.modalFilmSearch).validate({onfocusout:function(e){$(e).valid()},rules:{filmName:{required:!0}},errorClass:"error is-invalid"}),$($.fn.element.modalggSearch).validate({onfocusout:function(e){$(e).valid()},rules:{ggQuery:{required:!0}},errorClass:"error is-invalid"})},registerEvent:function(){$(document).on("change","#original, #password",function(e){e.preventDefault(),$("#mainForm").valid(),$("#create").removeAttr("disabled"),$("#fileName").html("Generated Link")}),$("#download").on("click",function(e){e.preventDefault(),document.location.href=$("#generated").val()}),$("#useProxy").on("click",function(e){e.preventDefault();const t=$("#generated");t.val(t.val().replace("fshare.vn","phamduy.me"))}),$("#openInVLC").on("click",function(e){e.preventDefault(),document.location.href=`vlc://${$("#generated").val()}`}),$("#create").on("click",function(e){if(e.preventDefault(),!$("#mainForm").valid())return;const t=$("#original").val(),n=t.split("?")[0].split("/").pop(),a=`https://www.fshare.vn/${isFile.test(t)?"file":"folder"}/${n}`,i=$("#password").val(),l=$(this);if($.fn.main.showLoading(l),isFile.test(a))$.post("/api/generate",{url:a,password:i},function(e){if($.fn.main.hideLoading(l,"Get Link"),!e.location){$(".action-btn").prop("disabled","disabled");let t="";switch(e.code){case 123:t="Invalid file password!";break;case 404:t="File not found!";break;default:t="Something went wrong!"}return $("#generated").val(t)}$("#generated").val(e.location.replace("http://","https://")),$("#fileName").html(`File name: <span class='text-success'>${decodeURI($("#generated").val().split("/").pop())}</span>`),$(".action-btn").removeAttr("disabled")});else if(isFolder.test(a)){const e=a.split("?")[0].split("/").pop();$.post("/api/getFolder",{code:e},function(e){$.fn.main.hideLoading(l,"Get Link");let t=`<label>Folder name: <span class='text-success'>${e.current.name}</span></label><select class="form-control" id="files">`;for(let n=0;n<e.items.length;n++){const a=e.items[n].mimetype?"file":"folder";t+=`<option value="https://www.fshare.vn/${a}/${e.items[n].linkcode}">${e.items[n].name}</option>`}t+="</select>",$("#itemList").html(t),$("#files").on("change click",function(e){e.preventDefault();const t=$(this).find(":selected").val();$("#original").val(t).trigger("change")})})}}),$(".js-textareacopybtn").on("click",function(e){e.preventDefault();const t=$("#generated").val();navigator.clipboard.writeText(t)}),$("#filmSearch").on("click",function(e){if(e.preventDefault(),!$("#filmSearchForm").valid())return;const t=$("#filmName").val(),n=$(this);$.fn.main.showLoading(n),$.post("/api/searchFilm",{filmName:t},function(e){if($.fn.main.hideLoading(n),"false"==e.status)return void $("#searchData").html('<label class="error is-invalid">No result.</label>');let t='<table class="table table-hover table-sm">\n            <thead class="thead-dark">\n              <tr>\n                <th scope="col">ID</th>\n                <th scope="col">Image</th>\n                <th scope="col">Name</th>\n                <th scope="col"></th>\n              </tr>\n            </thead>\n            <tbody>';for(let n=0;n<e.data.length;n++){const a=e.data[n];t+=`<tr>\n              <th scope="row">${n+1}</th>\n              <td>\n                  <img width="100" src="${a.image}">\n              </td>\n              <td>${a.title}</td>\n              <td>\n                <div class="btn-group">\n                    <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Select</button>\n                <div class="dropdown-menu">`;for(let e=0;e<a.links.length;e++){const n=a.links[e];t+=`<a class="dropdown-item" data-link="${n.link}">${n.title}</a>`}t+="</div></div></td></tr>"}t+="</tbody></table>",$("#searchData").html(t),$(".dropdown-item").on("click",function(){$("#original").val($(this).data("link")).trigger("change"),$("#staticBackdrop").modal("hide")})})}),$("#ggSearch").on("click",function(e){e.preventDefault();const t=$("#ggQuery").val();if(!$("#ggSearchForm").valid())return;const n=$(this);$.fn.main.showLoading(n),$.post("/api/ggSearch",{q:t},function(e){if($.fn.main.hideLoading(n),0==e.length)return void $("#ggSearchData").html('<label class="error is-invalid">No result.</label>');let t='<table class="table table-hover table-sm">\n            <thead class="thead-dark">\n              <tr>\n                <th scope="col">ID</th>\n                <th scope="col">Type</th>\n                <th scope="col">Name</th>\n                <th scope="col"></th>\n              </tr>\n            </thead>\n            <tbody>';for(let n=0;n<e.length;n++){const a=e[n];t+=`<tr>\n              <th scope="row">${n+1}</th>\n              <td>${a.link.includes("folder")?"Folder":"File"}</td>\n              <td>${a.htmlTitle}</td>\n              <td>\n                  <div class="btn-group">\n                      <button type="button" class="btn btn-success search-items" data-link="${a.link}" aria-haspopup="true" aria-expanded="false">Select</button>\n                  </div>\n              </td>\n              </tr>`}t+="</tbody></table>",$("#ggSearchData").html(t),$(".search-items").on("click",function(){$("#original").val($(this).data("link")).trigger("change"),$("#googleSearch").modal("hide")})})})},showLoading:function(e){e.html("<span class='spinner-border spinner-border-sm ml-4 mr-4' role='status' aria-hidden='true'></span>").attr("disabled",!0)},hideLoading:function(e,t="Search"){e.html(t).removeAttr("disabled")}}});